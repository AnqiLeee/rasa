
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Knowledge Base Actions</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/banner.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Dialogue Elements" href="../../dialogue-elements/dialogue-elements/" />
    <link rel="prev" title="Fallback Actions" href="../fallback-actions/" />

  <!-- Google Tag Manager -->
  <script type="opt-in" data-type="application/javascript" data-name="analytics">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MMHSZCS');</script>
  <!-- End Google Tag Manager -->
   
  
  <meta itemprop="image" content="https://rasa.com/assets/img/facebook-og.png">
  <meta property="og:title" content="Knowledge Base Actions" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rasa.com/assets/img/facebook-og.png" />
  <meta property="og:url" content="https://rasa.com/docs/rasa/core/knowledge-bases" />
  
    <meta name="description" content="Leverage information from knowledge bases inside conversations using ActionQueryKnowledgeBase
in open source bot framework Rasa." />
    <meta itemprop="description" content="Leverage information from knowledge bases inside conversations using ActionQueryKnowledgeBase
in open source bot framework Rasa.">
    <meta name="twitter:description" content="Leverage information from knowledge bases inside conversations using ActionQueryKnowledgeBase
in open source bot framework Rasa." />
    <meta property="og:description" content="Leverage information from knowledge bases inside conversations using ActionQueryKnowledgeBase
in open source bot framework Rasa." />
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Rasa_HQ">
  <meta name="twitter:title" content="Knowledge Base Actions">
  <meta name="twitter:creator" content="@Rasa_HQ">
  <meta name="twitter:image" content="https://rasa.com/assets/img/facebook-og.png">

  <link rel="stylesheet" href="../../_static/xq-light.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/fontawesome/css/fontawesome-all.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="https://rasa.com/assets/css/klaro.css">
  <script defer type="text/javascript" src="https://rasa.com/assets/js/klaro_config.js"></script>
  <script defer type="text/javascript" src="https://rasa.com/assets/js/klaro.js"></script>
  <script type="text/javascript" src="https://storage.googleapis.com/docs-theme/clipboard.min.js"></script>
  
    <link rel="icon" sizes="192x192" href="../../_static/icon-192x192.png">
    <link rel="apple-touch-icon" href="../../_static/icon-192x192.png" />
  
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head><body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe data-name="analytics" data-src="https://www.googletagmanager.com/ns.html?id=GTM-MMHSZCS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="announcement-banner" data-cookie-id="docsAnnouncementBannerDismissed">
  New episodes of the Rasa Masterclass are out now!
  <a href="https://www.youtube.com/watch?v=rlAQWbhwqLA&list=PL75e0qA87dlHQny7z43NduZHPo6qd-cRc" target="_blank">Watch Now</a>
  <button class="announcement-banner__close">✕</button>
</div>

<div class="nav-top">
  <div class="nav-container">
    <ul class="main-nav nav">
      <li>
      <a href="/docs/" class="brand-link">
          <img src="../../_static/rasa_logo.svg" width="80px" height="40px" title="Rasa logo" alt="Rasa logo">
    	    <span class="logo extension">docs</span>
    	</a>
      </li>
      	
          
      	    <li><a href=/docs/getting-started/>Getting Started</a></li>
      	  
      	
          
	        
      	      <li><a href=/docs/rasa/>Rasa Open Source</a></li>
            
      	  
      	
          
      	    <li><a href=/docs/rasa-x/>Rasa X</a></li>
      	  
      	
    </ul>
    <ul class="secondary-nav nav">
      <li>
        <input type="text" class="search ds-input" placeholder="Search documentation...">
      </li>
      <li>
        <a href="https://github.com/rasaHQ/" target="_blank"><button class="button btn-ghost white"> <i class="fab fa-github"></i>GitHub</button></a>
      </li>
      <li>
        <a href="https://forum.rasa.com" target="_blank"><button class="button"><i class="fas fa-comments"></i> Ask the Community</button></a>
      </li>
    </ul>
  </div>
</div>

  
    
      <div class="sidebar-extended"></div>
    
  

  
    
      <div class="document">
    
  

    
      
        
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/rasa-tutorial/">Rasa Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/command-line-interface/">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/messaging-and-voice-channels/">Messaging and Voice Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/evaluating-models/">Evaluating Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/validate-files/">Validate Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/running-the-server/">Running the Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/running-rasa-with-docker/">Running Rasa with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/cloud-storage/">Cloud Storage</a></li>
</ul>
<p class="caption"><span class="caption-text">NLU</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/about/">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/using-nlu-only/">Using NLU Only</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/training-data-format/">Training Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/choosing-a-pipeline/">Choosing a Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/language-support/">Language Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/entity-extraction/">Entity Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/components/">Components</a></li>
</ul>
<p class="caption"><span class="caption-text">Core</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stories/">Stories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../responses/">Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../actions/">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slots/">Slots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms/">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../retrieval-actions/">Retrieval Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive-learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fallback-actions/">Fallback Actions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Knowledge Base Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Conversation Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/dialogue-elements/">Dialogue Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/small-talk/">Small Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/completing-tasks/">Completing Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/guiding-users/">Guiding Users</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/action-server/">Action Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/http-api/">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/jupyter-notebooks/">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/custom-nlu-components/">Custom NLU Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/rasa-sdk/">Rasa SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracker/">Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracker-stores/">Tracker Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/event-brokers/">Event Brokers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/lock-stores/">Lock Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/training-data-importers/">Training Data Importers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/core-featurization/">Featurization of Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration-guide/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/">Rasa OSS Change Log</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrate from (beta)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/google-dialogflow-to-rasa/">Dialogflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/facebook-wit-ai-to-rasa/">Wit.ai</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/microsoft-luis-to-rasa/">LUIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/ibm-watson-to-rasa/">IBM Watson</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>

<div class="versions">
    <p class="caption">Versions</p>
    <div class="versions-content">
      <div>
        <span class="current-version">
          viewing: 1.6.1
        </span>
      </div>
      <div class="other-versions">
          <p>tags</p>
          <div class="dropdown-content">
              <a href="../../../1.7.1/core/knowledge-bases/">1.7.1</a>
              <a href="../../../1.7.0/core/knowledge-bases/">1.7.0</a>
              <a href="../../../1.6.2/core/knowledge-bases/">1.6.2</a>
              <a href="../../../1.6.1/core/knowledge-bases/">1.6.1</a>
              <a href="../../../1.6.0/core/knowledge-bases/">1.6.0</a>
              <a href="../../../1.5.3/core/knowledge-bases/">1.5.3</a>
              <a href="../../../1.4.6/core/knowledge-bases/">1.4.6</a>
              <a href="../../../1.3.10/core/knowledge-bases/">1.3.10</a>
              <a href="../../../1.2.9/index/">1.2.9</a>
              <a href="../../../1.1.8/index/">1.1.8</a>
              <a href="../../../1.0.9/index/">1.0.9</a>
          </div>
          <p>branches</p>
          <div class="dropdown-content">
              <a href="../../../master/core/knowledge-bases/">master</a>
          </div>
      </div>
    </div>
</div>


        </div>
      </div>
      
    
      
        
      
        <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  


    
    



    <p class="scv-banner"><a href="../../../1.7.1/core/knowledge-bases/"><b>Warning:</b> This document is for an old version of Rasa. The latest version is 1.7.1.</a></p>
<div class="section" id="knowledge-base-actions">
<span id="id1"></span><h1>Knowledge Base Actions<a class="headerlink" href="#knowledge-base-actions" title="Permalink to this headline">¶</a></h1>

  <div class="edit-link">
    <a class="reference external" href="https://github.com/RasaHQ/rasa/edit/master/docs/core/knowledge-bases.rst" target="_blank"><i class="fab fa-github" style="font-size: 85%; padding-right: 4px;"></i>SUGGEST EDITS</a>
  </div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This feature is experimental.
We introduce experimental features to get feedback from our community, so we encourage you to try it out!
However, the functionality might be changed or removed in the future.
If you have feedback (positive or negative) please share it with us on the <a class="reference external" href="https://forum.rasa.com">forum</a>.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#using-actionqueryknowledgebase" id="id4">Using <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code></a><ul>
<li><a class="reference internal" href="#create-a-knowledge-base" id="id5">Create a Knowledge Base</a></li>
<li><a class="reference internal" href="#define-the-nlu-data" id="id6">Define the NLU Data</a></li>
<li><a class="reference internal" href="#create-an-action-to-query-your-knowledge-base" id="id7">Create an Action to Query your Knowledge Base</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-it-works" id="id8">How It Works</a><ul>
<li><a class="reference internal" href="#query-the-knowledge-base-for-objects" id="id9">Query the Knowledge Base for Objects</a></li>
<li><a class="reference internal" href="#query-the-knowledge-base-for-an-attribute-of-an-object" id="id10">Query the Knowledge Base for an Attribute of an Object</a></li>
<li><a class="reference internal" href="#resolve-mentions" id="id11">Resolve Mentions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customization" id="id12">Customization</a><ul>
<li><a class="reference internal" href="#customizing-actionqueryknowledgebase" id="id13">Customizing <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code></a></li>
<li><a class="reference internal" href="#creating-your-own-knowledge-base-actions" id="id14">Creating Your Own Knowledge Base Actions</a></li>
<li><a class="reference internal" href="#customizing-the-inmemoryknowledgebase" id="id15">Customizing the <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code></a></li>
<li><a class="reference internal" href="#creating-your-own-knowledge-base" id="id16">Creating Your Own Knowledge Base</a></li>
</ul>
</li>
</ul>
</div>
<p>Knowledge base actions enable you to handle the following kind of conversations:</p>
<img alt="../../_images/knowledge-base-example.png" src="../../_images/knowledge-base-example.png" />
<p>A common problem in conversational AI is that users do not only refer to certain objects by their names,
but also use reference terms such as “the first one” or “it”.
We need to keep track of the information that was presented to resolve these mentions to
the correct object.</p>
<p>In addition, users may want to obtain detailed information about objects during a conversation –
for example, whether a restaurant has outside seating, or how expensive it is.
In order to respond to those user requests, knowledge about the restaurant domain is needed.
Since the information is subject to change, hard-coding the information isn’t the solution.</p>
<p>To handle the above challenges, Rasa can be integrated with knowledge bases. To use this integration, you can create a
custom action that inherits from <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code>, a pre-written custom action that contains
the logic to query a knowledge base for objects and their attributes.</p>
<p>You can find a complete example in <code class="docutils literal notranslate"><span class="pre">examples/knowledgebasebot</span></code>
(<a class="reference external" href="https://github.com/RasaHQ/rasa/blob/master/examples/knowledgebasebot/">knowledge base bot</a>), as well as instructions
for implementing this custom action below.</p>
<div class="section" id="using-actionqueryknowledgebase">
<h2><a class="toc-backref" href="#id4">Using <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code></a><a class="headerlink" href="#using-actionqueryknowledgebase" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-knowledge-base">
<span id="create-knowledge-base"></span><h3><a class="toc-backref" href="#id5">Create a Knowledge Base</a><a class="headerlink" href="#create-a-knowledge-base" title="Permalink to this headline">¶</a></h3>
<p>The data used to answer the user’s requests will be stored in a knowledge base.
A knowledge base can be used to store complex data structures.
We suggest you get started by using the <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code>.
Once you want to start working with a large amount of data, you can switch to a custom knowledge base
(see <a class="reference internal" href="#custom-knowledge-base"><span class="std std-ref">Creating Your Own Knowledge Base</span></a>).</p>
<p>To initialize an <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code>, you need to provide the data in a json file.
The following example contains data about restaurants and hotels.
The json structure should contain a key for every object type, i.e. <code class="docutils literal notranslate"><span class="pre">&quot;restaurant&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;hotel&quot;</span></code>.
Every object type maps to a list of objects – here we have a list of 3 restaurants and a list of 3 hotels.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;restaurant&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Donath&quot;</span><span class="p">,</span>
            <span class="nt">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Italian&quot;</span><span class="p">,</span>
            <span class="nt">&quot;outside-seating&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;mid-range&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Berlin Burrito Company&quot;</span><span class="p">,</span>
            <span class="nt">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Mexican&quot;</span><span class="p">,</span>
            <span class="nt">&quot;outside-seating&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;cheap&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;I due forni&quot;</span><span class="p">,</span>
            <span class="nt">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Italian&quot;</span><span class="p">,</span>
            <span class="nt">&quot;outside-seating&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;mid-range&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;hotel&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Hilton&quot;</span><span class="p">,</span>
            <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;expensive&quot;</span><span class="p">,</span>
            <span class="nt">&quot;breakfast-included&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Berlin&quot;</span><span class="p">,</span>
            <span class="nt">&quot;free-wifi&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;star-rating&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="nt">&quot;swimming-pool&quot;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Hilton&quot;</span><span class="p">,</span>
            <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;expensive&quot;</span><span class="p">,</span>
            <span class="nt">&quot;breakfast-included&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Frankfurt am Main&quot;</span><span class="p">,</span>
            <span class="nt">&quot;free-wifi&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;star-rating&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nt">&quot;swimming-pool&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;B&amp;B&quot;</span><span class="p">,</span>
            <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;mid-range&quot;</span><span class="p">,</span>
            <span class="nt">&quot;breakfast-included&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;city&quot;</span><span class="p">:</span> <span class="s2">&quot;Berlin&quot;</span><span class="p">,</span>
            <span class="nt">&quot;free-wifi&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
            <span class="nt">&quot;star-rating&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;swimming-pool&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once the data is defined in a json file, called, for example, <code class="docutils literal notranslate"><span class="pre">data.json</span></code>, you will be able use the this data file to create your
<code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code>, which will be passed to the action that queries the knowledge base.</p>
<p>Every object in your knowledge base should have at least the <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;id&quot;</span></code> fields to use the default implementation.
If it doesn’t, you’ll have to <a class="reference internal" href="#customize-in-memory-knowledge-base"><span class="std std-ref">customize your InMemoryKnowledgeBase</span></a>.</p>
</div>
<div class="section" id="define-the-nlu-data">
<h3><a class="toc-backref" href="#id6">Define the NLU Data</a><a class="headerlink" href="#define-the-nlu-data" title="Permalink to this headline">¶</a></h3>
<p>In this section:</p>
<ul class="simple">
<li>we will introduce a new intent, <code class="docutils literal notranslate"><span class="pre">query_knowledge_base</span></code></li>
<li>we will to annotate <code class="docutils literal notranslate"><span class="pre">mention</span></code> entities so that our model detects indirect mentions of objects like “the
first one”</li>
<li>we will use <a class="reference internal" href="../../nlu/training-data-format/#entity-synonyms"><span class="std std-ref">synonyms</span></a> extensively</li>
</ul>
<p>For the bot to understand that the user wants to retrieve information from the knowledge base, you need to define
a new intent. We will call it <code class="docutils literal notranslate"><span class="pre">query_knowledge_base</span></code>.</p>
<p>We can split requests that <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code> can handle into two categories:
(1) the user wants to obtain a list of objects of a specific type, or (2) the user wants to know about a certain
attribute of an object. The intent should contain lots of variations of both of these requests:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gu">##</span> intent:query_knowledge_base
<span class="k">-</span> what [<span class="nt">restaurants</span>](<span class="na">object_type:restaurant</span>) can you recommend?
<span class="k">-</span> list some [<span class="nt">restaurants</span>](<span class="na">object_type:restaurant</span>)
<span class="k">-</span> can you name some [<span class="nt">restaurants</span>](<span class="na">object_type:restaurant</span>) please?
<span class="k">-</span> can you show me some [<span class="nt">restaurant</span>](<span class="na">object_type:restaurant</span>) options
<span class="k">-</span> list [<span class="nt">German</span>](<span class="na">cuisine</span>) [<span class="nt">restaurants</span>](<span class="na">object_type:restaurant</span>)
<span class="k">-</span> do you have any [<span class="nt">mexican</span>](<span class="na">cuisine</span>) [<span class="nt">restaurants</span>](<span class="na">object_type:restaurant</span>)?
<span class="k">-</span> do you know the [<span class="nt">price range</span>](<span class="na">attribute:price-range</span>) of [<span class="nt">that one</span>](<span class="na">mention</span>)?
<span class="k">-</span> what [<span class="nt">cuisine</span>](<span class="na">attribute</span>) is [<span class="nt">it</span>](<span class="na">mention</span>)?
<span class="k">-</span> do you know what [<span class="nt">cuisine</span>](<span class="na">attribute</span>) the [<span class="nt">last one</span>](<span class="na">mention:LAST</span>) has?
<span class="k">-</span> does the [<span class="nt">first one</span>](<span class="na">mention:1</span>) have [<span class="nt">outside seating</span>](<span class="na">attribute:outside-seating</span>)?
<span class="k">-</span> what is the [<span class="nt">price range</span>](<span class="na">attribute:price-range</span>) of [<span class="nt">Berlin Burrito Company</span>](<span class="na">restaurant</span>)?
<span class="k">-</span> what about [<span class="nt">I due forni</span>](<span class="na">restaurant</span>)?
<span class="k">-</span> can you tell me the [<span class="nt">price range</span>](<span class="na">attribute</span>) of [<span class="nt">that restaurant</span>](<span class="na">mention</span>)?
<span class="k">-</span> what [<span class="nt">cuisine</span>](<span class="na">attribute</span>) do [<span class="nt">they</span>](<span class="na">mention</span>) have?
 ...
</pre></div>
</div>
<p>The above example just shows examples related to the restaurant domain.
You should add examples for every object type that exists in your knowledge base to the same <code class="docutils literal notranslate"><span class="pre">query_knowledge_base</span></code> intent.</p>
<p>In addition to adding a variety of training examples for each query type,
you need to specify the and annotate the following entities in your training examples:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">object_type</span></code>: Whenever a training example references a specific object type from your knowledge base, the object type should
be marked as an entity. Use <a class="reference internal" href="../../nlu/training-data-format/#entity-synonyms"><span class="std std-ref">synonyms</span></a> to map e.g. <code class="docutils literal notranslate"><span class="pre">restaurants</span></code> to <code class="docutils literal notranslate"><span class="pre">restaurant</span></code>, the correct
object type listed as a key in the knowledge base.</li>
<li><code class="docutils literal notranslate"><span class="pre">mention</span></code>: If the user refers to an object via “the first one”, “that one”, or “it”, you should mark those terms
as <code class="docutils literal notranslate"><span class="pre">mention</span></code>. We also use synonyms to map some of the mentions to symbols. You can learn about that
in <a class="reference internal" href="#resolve-mentions"><span class="std std-ref">resolving mentions</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">attribute</span></code>: All attribute names defined in your knowledge base should be identified as <code class="docutils literal notranslate"><span class="pre">attribute</span></code> in the
NLU data. Again, use synonyms to map variations of an attribute name to the one used in the
knowledge base.</li>
</ul>
<p>Remember to add those entities to your domain file (as entities and slots):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">entities</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">object_type</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mention</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">attribute</span>

<span class="l l-Scalar l-Scalar-Plain">slots</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">object_type</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">unfeaturized</span>
  <span class="l l-Scalar l-Scalar-Plain">mention</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">unfeaturized</span>
  <span class="l l-Scalar l-Scalar-Plain">attribute</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">unfeaturized</span>
</pre></div>
</div>
</div>
<div class="section" id="create-an-action-to-query-your-knowledge-base">
<span id="create-action-query-knowledge-base"></span><h3><a class="toc-backref" href="#id7">Create an Action to Query your Knowledge Base</a><a class="headerlink" href="#create-an-action-to-query-your-knowledge-base" title="Permalink to this headline">¶</a></h3>
<p>To create your own knowledge base action, you need to inherit <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code> and pass the knowledge
base to the constructor of <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyKnowledgeBaseAction</span><span class="p">(</span><span class="n">ActionQueryKnowledgeBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">knowledge_base</span> <span class="o">=</span> <span class="n">InMemoryKnowledgeBase</span><span class="p">(</span><span class="s2">&quot;data.json&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">knowledge_base</span><span class="p">)</span>
</pre></div>
</div>
<p>Whenever you create an <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code>, you need to pass a <code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code> to the constructor.
It can be either an <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code> or your own implementation of a <code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code>
(see <a class="reference internal" href="#custom-knowledge-base"><span class="std std-ref">Creating Your Own Knowledge Base</span></a>).
You can only pull information from one knowledge base, as the usage of multiple knowledge bases at the same time is not supported.</p>
<p>This is the entirety of the code for this action! The name of the action is <code class="docutils literal notranslate"><span class="pre">action_query_knowledge_base</span></code>.
Don’t forget to add it to your domain file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">action_query_knowledge_base</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you overwrite the default action name <code class="docutils literal notranslate"><span class="pre">action_query_knowledge_base</span></code>, you need to add the following three
unfeaturized slots to your domain file: <code class="docutils literal notranslate"><span class="pre">knowledge_base_objects</span></code>, <code class="docutils literal notranslate"><span class="pre">knowledge_base_last_object</span></code>, and
<code class="docutils literal notranslate"><span class="pre">knowledge_base_last_object_type</span></code>.
The slots are used internally by <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code>.
If you keep the default action name, those slots will be automatically added for you.</p>
</div>
<p>You also need to make sure to add a story to your stories file that includes the intent <code class="docutils literal notranslate"><span class="pre">query_knowledge_base</span></code> and
the action <code class="docutils literal notranslate"><span class="pre">action_query_knowledge_base</span></code>. For example:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gu">##</span> Happy Path
<span class="k">*</span> greet
  <span class="k">-</span> utter_greet
<span class="k">*</span> query_knowledge_base
  <span class="k">-</span> action_query_knowledge_base
<span class="k">*</span> goodbye
  <span class="k">-</span> utter_goodbye
</pre></div>
</div>
<p>The last thing you need to do is to define the template <code class="docutils literal notranslate"><span class="pre">utter_ask_rephrase</span></code> in your domain file.
If the action doesn’t know how to handle the user’s request, it will use this template to ask the user to rephrase.
For example, add the following templates to your domain file:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>utter_ask_rephrase:
<span class="k">-</span> text: &quot;Sorry, I&#39;m not sure I understand. Could you rephrase it?&quot;
<span class="k">-</span> text: &quot;Could you please rephrase your message? I didn&#39;t quite get that.&quot;
</pre></div>
</div>
<p>After adding all the relevant pieces, the action is now able to query the knowledge base.</p>
</div>
</div>
<div class="section" id="how-it-works">
<h2><a class="toc-backref" href="#id8">How It Works</a><a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code> looks at both the entities that were picked up in the request as well as the
previously set slots to decide what to query for.</p>
<div class="section" id="query-the-knowledge-base-for-objects">
<h3><a class="toc-backref" href="#id9">Query the Knowledge Base for Objects</a><a class="headerlink" href="#query-the-knowledge-base-for-objects" title="Permalink to this headline">¶</a></h3>
<p>In order to query the knowledge base for any kind of object, the user’s request needs to include the object type.
Let’s look at an example:</p>
<blockquote>
<div><cite>Can you please name some restaurants?</cite></div></blockquote>
<p>This question includes the object type of interest: “restaurant.”
The bot needs to pick up on this entity in order to formulate a query – otherwise the action would not know what objects the user is interested in.</p>
<p>When the user says something like:</p>
<blockquote>
<div><cite>What Italian restaurant options in Berlin do I have?</cite></div></blockquote>
<p>The user wants to obtain a list of restaurants that (1) have Italian cuisine and (2) are located in
Berlin. If the NER detects those attributes in the request of the user, the action will use those to filter the
restaurants found in the knowledge base.</p>
<p>In order for the bot to detect these attributes, you need to mark “Italian” and “Berlin” as entities in the NLU data:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>What [<span class="nt">Italian</span>](<span class="na">cuisine</span>) [<span class="nt">restaurant</span>](<span class="na">object_type</span>) options in [<span class="nt">Berlin</span>](<span class="na">city</span>) do I have?.
</pre></div>
</div>
<p>The names of the attributes, “cuisine” and “city,” should be equal to the ones used in the knowledge base.
You also need to add those as entities and slots to the domain file.</p>
</div>
<div class="section" id="query-the-knowledge-base-for-an-attribute-of-an-object">
<h3><a class="toc-backref" href="#id10">Query the Knowledge Base for an Attribute of an Object</a><a class="headerlink" href="#query-the-knowledge-base-for-an-attribute-of-an-object" title="Permalink to this headline">¶</a></h3>
<p>If the user wants to obtain specific information about an object, the request should include both the object and
attribute of interest.
For example, if the user asks something like:</p>
<blockquote>
<div><cite>What is the cuisine of Berlin Burrito Company?</cite></div></blockquote>
<p>The user wants to obtain the “cuisine” (attribute of interest) for the restaurant “Berlin Burrito Company” (object of
interest).</p>
<p>The attribute and object of interest should be marked as entities in the NLU training data:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>What is the [<span class="nt">cuisine</span>](<span class="na">attribute</span>) of [<span class="nt">Berlin Burrito Company</span>](<span class="na">restaurant</span>)?
</pre></div>
</div>
<p>Make sure to add the object type, “restaurant,” to the domain file as entity and slot.</p>
</div>
<div class="section" id="resolve-mentions">
<span id="id2"></span><h3><a class="toc-backref" href="#id11">Resolve Mentions</a><a class="headerlink" href="#resolve-mentions" title="Permalink to this headline">¶</a></h3>
<p>Following along from the above example, users may not always refer to restaurants by their names.
Users can either refer to the object of interest by its name, e.g. “Berlin Burrito Company” (representation string
of the object), or they may refer to a previously listed object via a mention, for example:</p>
<blockquote>
<div><cite>What is the cuisine of the second restaurant you mentioned?</cite></div></blockquote>
<p>Our action is able to resolve these mentions to the actual object in the knowledge base.
More specifically, it can resolve two mention types: (1) ordinal mentions, such as “the first one”, and (2)
mentions such as “it” or “that one”.</p>
<p><strong>Ordinal Mentions</strong></p>
<p>When a user refers to an object by its position in a list, it is called an ordinal mention. Here’s an example:</p>
<ul class="simple">
<li>User: <cite>What restaurants in Berlin do you know?</cite></li>
<li>Bot: <cite>Found the following objects of type ‘restaurant’:  1: I due forni  2: PastaBar  3: Berlin Burrito Company</cite></li>
<li>User: <cite>Does the first one have outside seating?</cite></li>
</ul>
<p>The user referred to “I due forni” by the term “the first one”.
Other ordinal mentions might include “the second one,” “the last one,” “any,” or “3”.</p>
<p>Ordinal mentions are typically used when a list of objects was presented to the user.
To resolve those mentions to the actual object, we use an ordinal mention mapping which is set in the
<code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code> class.
The default mapping looks like:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="s2">&quot;5&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
    <span class="s2">&quot;6&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;7&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
    <span class="s2">&quot;8&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
    <span class="s2">&quot;9&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
    <span class="s2">&quot;10&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
    <span class="s2">&quot;ANY&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">l</span><span class="p">),</span>
    <span class="s2">&quot;LAST&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>The ordinal mention mapping maps a string, such as “1”, to the object in a list, e.g. <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">l:</span> <span class="pre">l[0]</span></code>, meaning the
object at index <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>As the ordinal mention mapping does not, for example, include an entry for “the first one”,
it is important that you use <a class="reference internal" href="../../nlu/training-data-format/#entity-synonyms"><span class="std std-ref">Entity Synonyms</span></a> to map “the first one” in your NLU data to “1”:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>Does the [<span class="nt">first one</span>](<span class="na">mention:1</span>) have [<span class="nt">outside seating</span>](<span class="na">attribute:outside-seating</span>)?
</pre></div>
</div>
<p>The NER detects “first one” as a <code class="docutils literal notranslate"><span class="pre">mention</span></code> entity, but puts “1” into the <code class="docutils literal notranslate"><span class="pre">mention</span></code> slot.
Thus, our action can take the <code class="docutils literal notranslate"><span class="pre">mention</span></code> slot together with the ordinal mention mapping to resolve “first one” to
the actual object “I due forni”.</p>
<p>You can overwrite the ordinal mention mapping by calling the function <code class="docutils literal notranslate"><span class="pre">set_ordinal_mention_mapping()</span></code> on your
<code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code> implementation (see <a class="reference internal" href="#customize-in-memory-knowledge-base"><span class="std std-ref">Customizing the InMemoryKnowledgeBase</span></a>).</p>
<p><strong>Other Mentions</strong></p>
<p>Take a look at the following conversation:</p>
<ul class="simple">
<li>User: <cite>What is the cuisine of PastaBar?</cite></li>
<li>Bot: <cite>PastaBar has an Italian cuisine.</cite></li>
<li>User: <cite>Does it have wifi?</cite></li>
<li>Bot: <cite>Yes.</cite></li>
<li>User: <cite>Can you give me an address?</cite></li>
</ul>
<p>In the question “Does it have wifi?”, the user refers to “PastaBar” by the word “it”.
If the NER detected “it” as the entity <code class="docutils literal notranslate"><span class="pre">mention</span></code>, the knowledge base action would resolve it to the last mentioned
object in the conversation, “PastaBar”.</p>
<p>In the next input, the user refers indirectly to the object “PastaBar” instead of mentioning it explicitly.
The knowledge base action would detect that the user wants to obtain the value of a specific attribute, in this case, the address.
If no mention or object was detected by the NER, the action assumes the user is referring to the most recently
mentioned object, “PastaBar”.</p>
<p>You can disable this behaviour by setting <code class="docutils literal notranslate"><span class="pre">use_last_object_mention</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> when initializing the action.</p>
</div>
</div>
<div class="section" id="customization">
<h2><a class="toc-backref" href="#id12">Customization</a><a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="customizing-actionqueryknowledgebase">
<h3><a class="toc-backref" href="#id13">Customizing <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code></a><a class="headerlink" href="#customizing-actionqueryknowledgebase" title="Permalink to this headline">¶</a></h3>
<p>You can overwrite the following two functions of <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code> if you’d like to customize what the bot
says to the user:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">utter_objects()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">utter_attribute_value()</span></code></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">utter_objects()</span></code> is used when the user has requested a list of objects.
Once the bot has retrieved the objects from the knowledge base, it will respond to the user by default with a message, formatted like:</p>
<blockquote>
<div><cite>Found the following objects of type ‘restaurant’:</cite>
<cite>1: I due forni</cite>
<cite>2: PastaBar</cite>
<cite>3: Berlin Burrito Company</cite></div></blockquote>
<p>Or, if no objects are found,</p>
<blockquote>
<div><cite>I could not find any objects of type ‘restaurant’.</cite></div></blockquote>
<p>If you want to change the utterance format, you can overwrite the method <code class="docutils literal notranslate"><span class="pre">utter_objects()</span></code> in your action.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">utter_attribute_value()</span></code> determines what the bot utters when the user is asking for specific information about
an object.</p>
<p>If the attribute of interest was found in the knowledge base, the bot will respond with the following utterance:</p>
<blockquote>
<div><cite>‘Berlin Burrito Company’ has the value ‘Mexican’ for attribute ‘cuisine’.</cite></div></blockquote>
<p>If no value for the requested attribute was found, the bot will respond with</p>
<blockquote>
<div><cite>Did not find a valid value for attribute ‘cuisine’ for object ‘Berlin Burrito Company’.</cite></div></blockquote>
<p>If you want to change the bot utterance, you can overwrite the method <code class="docutils literal notranslate"><span class="pre">utter_attribute_value()</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a <a class="reference external" href="https://blog.rasa.com/integrating-rasa-with-knowledge-bases/">tutorial</a> on our blog about
how to use knowledge bases in custom actions. The tutorial explains the implementation behind
<code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code> in detail.</p>
</div>
</div>
<div class="section" id="creating-your-own-knowledge-base-actions">
<h3><a class="toc-backref" href="#id14">Creating Your Own Knowledge Base Actions</a><a class="headerlink" href="#creating-your-own-knowledge-base-actions" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code> should allow you to easily get started with integrating knowledge bases into your actions.
However, the action can only handle two kind of user requests:</p>
<ul class="simple">
<li>the user wants to get a list of objects from the knowledge base</li>
<li>the user wants to get the value of an attribute for a specific object</li>
</ul>
<p>The action is not able to compare objects or consider relations between objects in your knowledge base.
Furthermore, resolving any mention to the last mentioned object in the conversation might not always be optimal.</p>
<p>If you want to tackle more complex use cases, you can write your own custom action.
We added some helper functions to <code class="docutils literal notranslate"><span class="pre">rasa_sdk.knowledge_base.utils</span></code>
(<a class="reference external" href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">link to code</a> )
to help you when implement your own solution.
We recommend using <code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code> interface so that you can still use the <code class="docutils literal notranslate"><span class="pre">ActionQueryKnowledgeBase</span></code>
alongside your new custom action.</p>
<p>If you write a knowledge base action that tackles one of the above use cases or a new one, be sure to tell us about
it on the <a class="reference external" href="https://forum.rasa.com">forum</a>!</p>
</div>
<div class="section" id="customizing-the-inmemoryknowledgebase">
<span id="customize-in-memory-knowledge-base"></span><h3><a class="toc-backref" href="#id15">Customizing the <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code></a><a class="headerlink" href="#customizing-the-inmemoryknowledgebase" title="Permalink to this headline">¶</a></h3>
<p>The class <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code> inherits <code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code>.
You can customize your <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code> by overwriting the following functions:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">get_key_attribute_of_object()</span></code>: To keep track of what object the user was talking about last, we store the value
of the key attribute in a specific slot. Every object should have a key attribute that is unique,
similar to the primary key in a relational database. By default, the name of the key attribute for every object type
is set to <code class="docutils literal notranslate"><span class="pre">id</span></code>. You can overwrite the name of the key attribute for a specific object type by calling
<code class="docutils literal notranslate"><span class="pre">set_key_attribute_of_object()</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">get_representation_function_of_object()</span></code>: Let’s focus on the following restaurant:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Donath&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cuisine&quot;</span><span class="p">:</span> <span class="s2">&quot;Italian&quot;</span><span class="p">,</span>
    <span class="nt">&quot;outside-seating&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;price-range&quot;</span><span class="p">:</span> <span class="s2">&quot;mid-range&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When the user asks the bot to list any Italian restaurant, it doesn’t need all of the details of the restaurant.
Instead, you want to provide a meaningful name that identifies the restaurant – in most cases, the name of the object will do.
The function <code class="docutils literal notranslate"><span class="pre">get_representation_function_of_object()</span></code> returns a lambda function that maps the
above restaurant object to its name.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This function is used whenever the bot is talking about a specific object, so that the user is presented a meaningful
name for the object.</p>
<p>By default, the lambda function returns the value of the <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code> attribute of the object.
If your object does not have a <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code> attribute , or the <code class="docutils literal notranslate"><span class="pre">&quot;name&quot;</span></code> of an object is
ambiguous, you should set a new lambda function for that object type by calling
<code class="docutils literal notranslate"><span class="pre">set_representation_function_of_object()</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">set_ordinal_mention_mapping()</span></code>: The ordinal mention mapping is needed to resolve an ordinal mention, such as
“second one,” to an object in a list. By default, the ordinal mention mapping looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="s2">&quot;5&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
    <span class="s2">&quot;6&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;7&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
    <span class="s2">&quot;8&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
    <span class="s2">&quot;9&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
    <span class="s2">&quot;10&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
    <span class="s2">&quot;ANY&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">l</span><span class="p">),</span>
    <span class="s2">&quot;LAST&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can overwrite it by calling the function <code class="docutils literal notranslate"><span class="pre">set_ordinal_mention_mapping()</span></code>.
If you want to learn more about how this mapping is used, check out <a class="reference internal" href="#resolve-mentions"><span class="std std-ref">Resolve Mentions</span></a>.</p>
</li>
</ul>
<p>See the <a class="reference external" href="https://github.com/RasaHQ/rasa/blob/master/examples/knowledgebasebot/actions.py">example bot</a> for an
example implementation of an <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code> that uses the method <code class="docutils literal notranslate"><span class="pre">set_representation_function_of_object()</span></code>
to overwrite the default representation of the object type “hotel.”
The implementation of the <code class="docutils literal notranslate"><span class="pre">InMemoryKnowledgeBase</span></code> itself can be found in the
<a class="reference external" href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">rasa-sdk</a> package.</p>
</div>
<div class="section" id="creating-your-own-knowledge-base">
<span id="custom-knowledge-base"></span><h3><a class="toc-backref" href="#id16">Creating Your Own Knowledge Base</a><a class="headerlink" href="#creating-your-own-knowledge-base" title="Permalink to this headline">¶</a></h3>
<p>If you have more data or if you want to use a more complex data structure that, for example, involves relations between
different objects, you can create your own knowledge base implementation.
Just inherit <code class="docutils literal notranslate"><span class="pre">KnowledgeBase</span></code> and implement the methods <code class="docutils literal notranslate"><span class="pre">get_objects()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_object()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">get_attributes_of_object()</span></code>. The <a class="reference external" href="https://github.com/RasaHQ/rasa-sdk/tree/master/rasa_sdk/knowledge_base/">knowledge base code</a>
provides more information on what those methods should do.</p>
<p>You can also customize your knowledge base further, by adapting the methods mentioned in the section
<a class="reference internal" href="#customize-in-memory-knowledge-base"><span class="std std-ref">Customizing the InMemoryKnowledgeBase</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We wrote a <a class="reference external" href="https://blog.rasa.com/set-up-a-knowledge-base-to-encode-domain-knowledge-for-rasa/">blog post</a>
that explains how you can set up your own knowledge base.</p>
</div>
</div>
</div>
</div>


	    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
	    <script type="text/javascript"> docsearch({
	     apiKey: '1f9e0efb89e98543f6613a60f847b176',
	     indexName: 'rasa',
	     inputSelector: 'body > div.nav-top > .nav-container > .nav > li > input',
	     debug: false // Set debug to true if you want to inspect the dropdown
	    });
	    </script>
          </div>

          <div class="footer">
            <div class="questions">
              Stuck?
              <a class="reference external" href="https://forum.rasa.com" target="_blank">Ask a Question</a>
              or
              <a class="reference external" href="https://github.com/rasahq/rasa/issues" target="_blank">Create an Issue</a>
            </div>
            <div class="social">
              <a href="https://github.com/RasaHQ" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
              <a href="https://stackoverflow.com/search?q=rasa" target="_blank" title="Stack Overflow"><i class="fab fa-stack-overflow"></i></a>
              <a href="https://www.youtube.com/channel/UCJ0V6493mLvqdiVwOKWBODQ" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
              <a href="https://twitter.com/rasa_hq" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
            </div>

            <div class="copyright small">
            &copy;2019, Rasa Technologies | <a href="https://rasa.com/imprint/" target="_blank">Imprint</a> | <a href="https://rasa.com/privacy-policy/" target="_blank">Privacy Policy</a>
            
            </div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>

    

  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag(...arguments) {
      dataLayer.push(...arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-87333416-1', {
      'anonymize_ip': true,
    });
  </script>
  <script src="https://rasa.com/assets/js/js.cookies.js"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script type="opt-in" data-name="analytics" data-type="text/javascript" data-src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script type="opt-in" data-name="analytics" data-type="text/javascript" data-src="https://rasa.com/assets/js/userId.js"></script>

  <script type="text/javascript">
    var clipboard = new ClipboardJS('.copyable');
    clipboard.on('success', function(e) {
      gtag('event', e.action, {
        'event_category': 'code',
        'event_label': e.text
      });
      const id = e.text.replace(/ /g,'-');
      document.getElementById(id).classList.add('visible');
      setTimeout(function(){
        document.getElementById(id).classList.remove('visible');},
        800
      );
    });
    clipboard.on('error', function(e) {
      console.log(e);
    });

  </script>

  <!-- Dismissable announcement banner -->
  <script>
    var banners = document.querySelectorAll('.announcement-banner');

    Array.from(banners).forEach(function(banner) {
      var cookie_id = banner.dataset['cookie-id'];

      if (localStorage.getItem(cookie_id) !== 'true') {
        banner.classList.add('announcement-banner--visible');
      }

      var bannerCloseButton = banner.querySelector('.announcement-banner__close');

      bannerCloseButton && bannerCloseButton.addEventListener('click', function() {
        localStorage.setItem(cookie_id, 'true');
        banner.classList.remove('announcement-banner--visible');
      });
    });
  </script>

  <!-- onsite anchor fix (otherwise anchors scroll to far) -->
  <script>
    /* Adapted from https://stackoverflow.com/a/13067009/1906073 */
    (function(document, history, location) {
      var HISTORY_SUPPORT = !!(history && history.pushState);

      var anchorScrolls = {
        ANCHOR_REGEX: /^#[^ ]+$/,
        OFFSET_HEIGHT_PX: 66,

        /**
         * Establish events, and fix initial scroll position if a hash is provided.
         */
        init: function() {
          this.scrollToCurrent();
          $(window).on('hashchange', $.proxy(this, 'scrollToCurrent'));
          $('body').on('click', 'a', $.proxy(this, 'delegateAnchors'));
        },

        /**
         * Return the offset amount to deduct from the normal scroll position.
         * Modify as appropriate to allow for dynamic calculations
         */
        getFixedOffset: function() {
          return this.OFFSET_HEIGHT_PX;
        },

        /**
         * If the provided href is an anchor which resolves to an element on the
         * page, scroll to it.
         * @param  {String} href
         * @return {Boolean} - Was the href an anchor.
         */
        scrollIfAnchor: function(href, pushToHistory) {
          var match, anchorOffset;

          if(!this.ANCHOR_REGEX.test(href)) {
            return false;
          }

          match = document.getElementById(href.slice(1));

          if(match) {
            anchorOffset = $(match).offset().top - this.getFixedOffset();
            $('html, body').animate({ scrollTop: anchorOffset});

            // Add the state to history as-per normal anchor links
            if(HISTORY_SUPPORT && pushToHistory) {
              history.pushState({}, document.title, location.pathname + href);
            }
          }

          return !!match;
        },

        /**
         * Attempt to scroll to the current location's hash.
         */
        scrollToCurrent: function(e) {
          if(this.scrollIfAnchor(window.location.hash) && e) {
            e.preventDefault();
          }
        },

        /**
         * If the click event's target was an anchor, fix the scroll position.
         */
        delegateAnchors: function(e) {
          var elem = e.target;

          if(this.scrollIfAnchor(elem.getAttribute('href'), true)) {
            e.preventDefault();
          }
        }
      };

      $(document).ready($.proxy(anchorScrolls, 'init'));
    })(window.document, window.history, window.location);

  </script>
  <script type="opt-in" data-name="analytics" data-type="text/javascript" data-src="https://rasa.com/assets/js/u-info.js"></script>
      <div class="webchat-banner webchat-banner--hidden">
        <img src="https://rasa.com/assets/img/demo/sara_avatar.png" class="webchat-banner__avatar" alt="">
        👋 I can help you get started with Rasa and answer your technical questions.
        <button class="webchat-banner__close">
          <i class="fas fa-times"></i> 
        </button>
      </div>
      <div id="webchat">
        <script src="../../_static/rasa-webchat.js"></script>
        <script>
          WebChat.default.init({
            selector: "#webchat",
            initPayload: "/greet",
            socketUrl: "https://website-demo.rasa.com/",
            socketPath: "/socket.io",
            title: "Sara",
            subtitle: "I'm still in development",
            profileAvatar: "https://rasa.com/assets/img/demo/sara_avatar.png",
            showCloseButton: true,
            fullScreenMode: false,
            hideWhenNotConnected: false,
            connectOn: "open",
            autoClearCache: true,
            linksOpenTab: false,
            openLauncherImage: "../../_static/chat-icon.svg",
            customMessageDelay: (message) => {
              return 900 + message.length;
            },
            params: {
              storage: "local"
            },
            onWidgetEvent: {
              onChatOpen: () => {
                const webchatBanner = document.querySelector('.webchat-banner');
                if (webchatBanner) {
                  localStorage.setItem('WEBCHAT_BANNER_DISMISSED', 'true');
                  webchatBanner.classList.add('webchat-banner--hidden');
                }
              }
            }
          });

          try {
            const webchatBanner = document.querySelector('.webchat-banner');

            if (webchatBanner) {
              if (localStorage.getItem('WEBCHAT_BANNER_DISMISSED') !== 'true') {
                webchatBanner.classList.remove('webchat-banner--hidden');
              }

              const webChatBannerClose = document.querySelector('.webchat-banner__close');

              webChatBannerClose && webChatBannerClose.addEventListener('click', function() {
                localStorage.setItem('WEBCHAT_BANNER_DISMISSED', 'true');
                webchatBanner.classList.add('webchat-banner--hidden');
              });
            }
          } catch (e) {}
        </script>
      </div>
  </body>
</html>